<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Profile â€” Health & Wellness</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background-color: #f9f8ff;
      display: flex;
      min-height: 100vh;
      margin: 0;
      overflow-x: hidden;
    }

    /* Sidebar */
    .sidebar {
      width: 250px;
      /* === THEME CHANGE === */
      background: linear-gradient(180deg, #0d6efd, #0a58ca);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      padding: 25px 15px;
    }

    .sidebar h4 {
      text-align: center;
      font-weight: 700;
      margin-bottom: 30px;
    }

    .sidebar a {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: #eae4ff;
      padding: 10px 15px;
      border-radius: 10px;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .sidebar a:hover,
    .sidebar a.active {
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
    }

    .logout-btn {
      color: #ffdede !important;
    }

    /* Main Content */
    .main {
      margin-left: 250px;
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .header {
      /* === THEME CHANGE === */
      background: linear-gradient(135deg, #e7f0ff, #fff9e0);
      text-align: center;
      padding: 3rem 1rem 5rem;
      border-bottom-left-radius: 60px;
      border-bottom-right-radius: 60px;
      position: relative;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .header img {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      border: 5px solid white;
      object-fit: cover;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
      position: absolute;
      bottom: -55px;
      left: 50%;
      transform: translateX(-50%);
    }

    .header h3 {
      font-weight: 700;
      color: #222;
    }

    .header p {
      margin: 0;
      color: #555;
    }

    .content {
      padding: 6rem 2rem 2rem;
    }

    .action-btn {
      /* === THEME CHANGE === */
      background: #0d6efd;
      color: #fff;
      border-radius: 20px;
      padding: 8px 16px;
      border: none;
      font-size: 0.9rem;
      transition: all 0.3s;
    }

    .action-btn:hover {
      /* === THEME CHANGE === */
      background: #0a58ca;
    }

    /* Cards */
    .option-card {
      background: white;
      border-radius: 15px;
      padding: 15px 20px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
      transition: all 0.3s;
      cursor: pointer;
    }

    .option-card:hover {
      transform: translateY(-3px);
      /* === THEME CHANGE === */
      box-shadow: 0 4px 15px rgba(13, 110, 253, 0.15);
    }

    .option-card i {
      font-size: 1.3rem;
      /* === THEME CHANGE === */
      color: #0d6efd;
      margin-right: 10px;
    }

    /* Edit Form */
    #editSection {
      display: none;
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      max-width: 600px;
      margin: 2rem auto;
    }

    /* --- FIX VIDEO SECTION --- */
    .video-banner {
      position: relative;
      width: 100%;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 260px;
      margin-top: 2rem;
      margin-bottom: 0;
    }

    .video-wrapper {
      display: flex;
      width: 200%;
    }

    .video-wrapper video {
      width: 50%;
      height: 260px;
      object-fit: cover;
      filter: brightness(0.7);
    }

    .banner-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      /* === THEME CHANGE === */
      background: linear-gradient(90deg, rgba(13, 110, 253, 0.25), rgba(255, 193, 7, 0.25));
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      text-align: center;
      text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    }

    .banner-overlay h4 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
    }

    .banner-overlay p {
      font-size: 1rem;
      opacity: 0.95;
    }

    /* Footer under video */
    .footer-bar {
      /* === THEME CHANGE === */
      background: linear-gradient(90deg, #0d6efd, #0a58ca);
      color: #fff;
      text-align: center;
      padding: 10px;
      font-size: 0.9rem;
      font-weight: 500;
      margin: 0;
      border-top: none;
    }

    html,
    body {
      overflow-x: hidden;
      margin: 0;
      padding: 0;
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 70px;
      }

      .sidebar h4,
      .sidebar a span {
        display: none;
      }

      .main {
        margin-left: 70px;
      }
    }

    
  </style>
</head>

<body>
  <aside class="sidebar">
    <div>
      <h4>Wellness</h4>
      <nav class="nav flex-column">
        <a href="home.html"><i class="bi bi-house-door-fill"></i><span>Home</span></a>
        <a href="experts.html"><i class="bi bi-person-lines-fill"></i><span>Find Experts</span></a>
        <a href="favorites.html"><i class="bi bi-heart-fill"></i><span>Favorites</span></a>
        <a href="health_box.html"><i class="bi bi-clipboard2-heart-fill"></i><span>Health Box</span></a>
        <a href="payments.html"><i class="bi bi-wallet2"></i><span>Payments</span></a>
        <a href="profile.html" class="active"><i class="bi bi-person-circle"></i><span>Profile</span></a>
      </nav>
    </div>
    <a href="#" class="logout-btn" id="logoutBtn"><i class="bi bi-box-arrow-right"></i><span>Logout</span></a>
  </aside>

  <div class="main">
    <section class="header">
      <h3 id="displayName">Loading...</h3>
      <p id="displayEmail">â€”</p>
      <p><i class="bi bi-telephone"></i> <span id="displayPhone">â€”</span></p>
      <p><i class="bi bi-geo-alt"></i> <span id="displayAddress">â€”</span></p>
      <img src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png" alt="Profile Photo" />
    </section>

    <section class="content">
      <div class="text-center mb-4">
        <button id="editBtn" class="action-btn"><i class="bi bi-pencil-square"></i> Edit Profile</button>
      </div>

      <div class="option-card" onclick="navigate('booking.html')">
        <div><i class="bi bi-calendar-check"></i> Book Appointments</div>
        <i class="bi bi-chevron-right"></i>
      </div>

      <div class="option-card" onclick="navigate('payments.html')">
        <div><i class="bi bi-wallet2"></i> Payment History</div>
        <i class="bi bi-chevron-right"></i>
      </div>

      <div class="option-card" onclick="navigate('health_box.html')">
        <div><i class="bi bi-file-medical"></i> Health Reports</div>
        <i class="bi bi-chevron-right"></i>
      </div>

      <div class="option-card" onclick="toggleAccountSettings()">
        <div><i class="bi bi-person-gear"></i> Account Details</div>
        <i class="bi bi-chevron-right"></i>
      </div>      

      <div id="editSection">
        <h5 class="text-center mb-3 text-primary">Edit Profile</h5>
        <form id="profileForm">
          <div class="mb-3">
            <label class="form-label">Full Name</label>
            <input type="text" id="name" class="form-control" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" id="email" class="form-control" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Phone</label>
            <input type="text" id="phone" class="form-control" />
          </div>
          <div class="mb-3">
            <label class="form-label">Address</label>
            <input type="text" id="address" class="form-control" />
          </div>
          <div class="text-center">
            <button type="submit" class="btn btn-success me-2">Save</button>
            <button type="button" class="btn btn-secondary" onclick="toggleEdit()">Cancel</button>
          </div>
        </form>
      </div>
    </section>

    <div id="accountSettings" style="display: none;">
      <h5 class="text-center mb-3 text-primary">Account Settings</h5>
    
      <div class="option-card" onclick="navigate('settings.html')">
        <div><i class="bi bi-gear-fill"></i> General Settings</div>
        <i class="bi bi-chevron-right"></i>
      </div>
    
      <div class="option-card d-flex justify-content-between align-items-center">
        <div><i class="bi bi-bell-fill"></i> App Notifications</div>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="toggleNotifications" checked>
        </div>
      </div>
    
      <div class="option-card" onclick="toggleParagraph('privacyDesc')">
        <div><i class="bi bi-shield-lock-fill"></i> Privacy & Data</div>
        <i class="bi bi-chevron-down"></i>
      </div>
      <div id="privacyDesc" class="info-paragraph" style="display:none; padding: 15px; background: #f8f9fa; border-radius: 10px; margin-bottom: 15px; line-height: 1.6; color: #333;">
        Patient data is kept strictly confidential and safeguarded at every stage of processing. All personal and medical information is encrypted and stored on secure servers with restricted access. Our platform adheres to international privacy standards and regulations, ensuring that your data is never shared with third parties without your explicit consent. Detailed audit logs are maintained to track any access to sensitive information. Additionally, we regularly update our security protocols and conduct privacy impact assessments to minimize risk. By using our services, you agree to our privacy policy, which outlines the types of information collected, the purposes for which it is used, and your rights over your data. We are committed to transparency and provide users with tools to manage, download, or delete their data at any time. Your trust is paramount, and protecting your health information is our highest priority.
      </div>
      
      <script>
        function toggleParagraph(id) {
          const para = document.getElementById(id);
          para.style.display = para.style.display === "none" ? "block" : "none";
        }
      </script>      
      
    
      <div class="option-card d-flex justify-content-between align-items-center">
        <div><i class="bi bi-lock-fill"></i> Security</div>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="toggleSecurity">
        </div>
      </div>
    
      <div class="text-center mt-3">
        <button class="btn btn-secondary" onclick="toggleAccountSettings()">Close</button>
      </div>
    </div>
    
    

    <section class="video-banner">
      <div class="video-wrapper">
        <video autoplay muted loop playsinline>
          <source src="./images/vdo1.mp4" type="video/mp4" />
        </video>
        <video autoplay muted loop playsinline>
          <source src="./images/vdo1.mp4" type="video/mp4" />
        </video>
      </div>
      <div class="banner-overlay">
        <h4>Your Journey to Better Health Starts Here ðŸ’š</h4>
        <p>Stay consistent. Stay positive. Stay well with Health & Wellness.</p>
      </div>
    </section>

    <footer class="footer-bar">&copy; 2025 Health & Wellness Platform</footer>
  </div>

  <script>
    const token = localStorage.getItem('token');
    const userId = localStorage.getItem('user_id');

    if (!token || !userId) {
      alert("Please login first!");
      window.location.href = "login.html";
    }

    const editSection = document.getElementById("editSection");

    async function loadProfile() {
      try {
        const res = await fetch(`http://localhost:3000/api/users/${userId}`, {
          headers: { Authorization: `Bearer ${token}` },
        });
        const result = await res.json();

        if (result.success && result.user) {
          const user = result.user;
          document.getElementById("displayName").textContent = user.name || "User";
          document.getElementById("displayEmail").textContent = user.email || "â€”";
          document.getElementById("displayPhone").textContent = user.profile?.phone || "Not provided";
          document.getElementById("displayAddress").textContent = user.profile?.address || "Not provided";

          document.getElementById("name").value = user.name || "";
          document.getElementById("email").value = user.email || "";
          document.getElementById("phone").value = user.profile?.phone || "";
          document.getElementById("address").value = user.profile?.address || "";
        } else {
          alert("Failed to fetch profile data.");
        }
      } catch (err) {
        console.error("Error loading profile:", err);
        alert("Could not connect to backend.");
      }
    }


    function toggleEdit() {
      editSection.style.display = editSection.style.display === "none" ? "block" : "none";
      window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
    }

    // Attach toggle to Edit Profile button
    document.getElementById("editBtn").addEventListener("click", toggleEdit);

    const accountSettings = document.getElementById("accountSettings");

function toggleAccountSettings() {
  accountSettings.style.display = accountSettings.style.display === "none" ? "block" : "none";
  // Scroll to section
  if (accountSettings.style.display === "block") {
    window.scrollTo({ top: accountSettings.offsetTop, behavior: "smooth" });
  }
}

document.getElementById("toggleNotifications").addEventListener("change", (e) => {
  alert("Notifications " + (e.target.checked ? "enabled" : "disabled"));
});

// document.getElementById("togglePrivacy").addEventListener("change", (e) => {
//   alert("Privacy & Data " + (e.target.checked ? "enabled" : "disabled"));
// });

document.getElementById("toggleSecurity").addEventListener("change", (e) => {
  alert("Security " + (e.target.checked ? "enabled" : "disabled"));
});


    document.getElementById("profileForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const data = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        profile: {
          phone: document.getElementById("phone").value,
          address: document.getElementById("address").value,
        },
      };

      try {
        const res = await fetch(`http://localhost:3000/api/users/${userId}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify(data),
        });
        const result = await res.json();
        if (result.success) {
          alert("Profile updated successfully!");
          toggleEdit();
          loadProfile();
        } else {
          alert("Failed to update profile.");
        }
      } catch (err) {
        console.error("Error updating profile:", err);
      }
    });

    function navigate(url) {
      window.location.href = url;
    }


    document.getElementById("logoutBtn").addEventListener("click", (e) => {
      e.preventDefault();
      localStorage.clear();
      window.location.href = "login.html";
    });

    loadProfile();

  </script>
</body>

</html>